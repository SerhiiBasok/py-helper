{% extends "base.html" %}

{% block content %}

  <div class="container py-5">
    {% if applications %}
      <div class="row">
        {% for app in applications %}
          <div class="col-12 mb-4">
            <div class="card bg-dark text-white shadow-sm w-100 hover-card"
                 style="border-radius: 1rem; overflow: hidden; transition: transform 0.2s, box-shadow 0.2s;">
              <div class="card-header bg-secondary d-flex justify-content-between align-items-center py-2 px-3">
                <div>
                  <h5 class="card-title text-uppercase mb-1 text-white">
                    {{ app.user.first_name }} {{ app.user.last_name }} applied "{{ app.advertisement.title }}"
                  </h5>
                  <a href="{% url 'ratings:user-info' user_id=app.user.id %}" class="btn btn-dark btn-sm mt-2">View
                    Profile</a>
                </div>
                <span class="text-white-50 small">{{ app.created_at|date:"d M Y H:i" }}</span>
              </div>
              <div class="card-body py-3 px-3">
                {% if app.message %}
                  <p class="card-text text-white-50 mb-2">{{ app.message }}</p>
                {% endif %}
                {% if app.status == "pending" %}
                  <div class="d-flex gap-2 flex-wrap mt-3">
                    <form method="post" action="{% url 'advertisements:accept_application' app.pk %}"
                          class="flex-grow-1">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-success btn-sm w-100">Approve</button>
                    </form>
                    <form method="post" action="{% url 'advertisements:reject_application' app.pk %}"
                          class="flex-grow-1">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-danger btn-sm w-100">Reject</button>
                    </form>
                  </div>
                {% elif app.status == "accepted" %}
                  <div class="d-flex gap-2 align-items-center mt-3">
                    <span class="badge bg-success">Approved</span>
                    <form method="post" action="{% url 'advertisements:done_application' app.pk %}">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-dark btn-sm">Job was done</button>
                    </form>
                  </div>
                {% endif %}
              </div>

            </div>
          </div>
        {% endfor %}
      </div>
      <div class="mt-3 text-center">
        <a href="{% url 'accounts:profile' pk=request.user.profile.pk %}" class="btn btn-outline-light btn-lg">Back</a>
      </div>
    {% else %}
      <div class="alert alert-secondary text-center py-5">
        No new applications
      </div>
      <div class="mt-3 text-center">
        <a href="{% url 'accounts:profile' pk=request.user.profile.pk %}" class="btn btn-outline-light btn-lg">Back</a>
        <a href="{% url 'accounts:profile' pk=user.id %}"
           class="btn btn-dark btn-lg shadow rounded-pill px-4"
           style="transition: transform 0.2s;">
          Cancel
        </a>
      </div>
    {% endif %}
  </div>
  <style>
      .hover-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.5);
      }

      .btn-dark:hover {
          background-color: #343a40;
          color: #fff;
      }
  </style>
{% endblock %}
