{% extends "base.html" %}

{% block content %}
  <div class="container my-5">
    <div class="card bg-dark text-white shadow-sm">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h3 class="mb-0">User Profile: {{ profile.user.username }}</h3>
        <div class="d-flex gap-2">
          <a href="{% url 'ratings:user-info' user_id=profile.user.id %}" class="btn btn-outline-light btn-sm">
            My Ratings
          </a>
          <a href="{% url 'advertisements:create-advertisement' %}" class="btn btn-outline-light btn-sm">
            Create Advertisement
          </a>
          <a href="{% url 'accounts:profile-serving' pk=user.id %}" class="btn btn-outline-light btn-sm">
            Messages
          </a>
        </div>

      </div>
      <div class="card-body">

        <div class="mb-3">
          <p><strong>First name:</strong> {{ profile.user.first_name|default:"Not provided" }}</p>
          <p><strong>Last name:</strong> {{ profile.user.last_name|default:"Not provided" }}</p>
        </div>

        <p><strong>Username:</strong> {{ profile.user.username }}</p>
        <p><strong>Email:</strong> {{ profile.user.email }}</p>

        <p><strong>Phone:</strong> {{ profile.phone|default:"Not provided" }}</p>
        <p><strong>Bio:</strong> {{ profile.bio|default:"No bio available" }}</p>

        <p><strong>Categories:</strong>
          {% if profile.categories.all %}
            <ul class="list-group list-group-flush bg-dark">
              {% for category in profile.categories.all %}
                <li class="list-group-item bg-dark text-white p-1">{{ category.name }}</li>
              {% endfor %}
            </ul>
          {% else %}
            None
          {% endif %}
        <br>
        <a href="{% url 'accounts:profile-update' user.profile.pk %}" class="btn btn-outline-light btn-sm mt-2">Update
          Profile</a>
      </div>
    </div>
    <div class="row mt-4">
      {% for ad in profile.user.advertisements.all %}
        <div class="col-12 mb-3">
          <div class="card bg-dark text-white shadow-sm w-100 hover-card"
               style="border-radius: 1rem; overflow: hidden; transition: transform 0.2s, box-shadow 0.2s;">

            <div class="card-header bg-secondary d-flex justify-content-between align-items-center py-2 px-3">
              <h5 class="card-title text-uppercase mb-0">{{ ad.title }}</h5>
              <span class="badge bg-success fs-6">{{ ad.price }}$</span>
            </div>

            <div class="card-body py-3 px-3">
              <p class="card-text text-white-50 mb-2">{{ ad.description }}</p>

              {% if ad.categories.all %}
                <div class="mb-2">
                  {% for category in ad.categories.all %}
                    <span class="badge bg-success me-1 mb-1">#{{ category.name }}</span>
                  {% endfor %}
                </div>
              {% endif %}

              <div class="d-flex justify-content-between flex-wrap text-white-50 mb-2 small">
                <span><i class="bi bi-geo-alt-fill me-1"></i>{{ ad.location }}</span>
                <span><i class="bi bi-calendar3 me-1"></i>{{ ad.created_at|date:"d M Y H:i" }}</span>
                <span>
              <i class="bi bi-person-fill me-1"></i>
              <a href="{% url 'ratings:user-info' user_id=ad.user.id %}" class="text-decoration-none text-white-50">
                {% if ad.user.first_name or ad.user.last_name %}
                  {{ ad.user.first_name }} {{ ad.user.last_name }}
                {% else %}
                  {{ ad.user.username }}
                {% endif %}
              </a>
            </span>
              </div>

              <div class="d-flex justify-content-end align-items-center">
                {% if ad.user == request.user %}
                  <a href="{% url 'advertisements:update-advertisement' ad.pk %}"
                     class="btn btn-outline-light btn-sm me-2">
                    <i class="bi bi-pencil-fill me-1"></i>Edit
                  </a>
                  <a href="{% url 'advertisements:delete-advertisement' ad.pk %}"
                     class="btn btn-outline-light btn-sm">
                    <i class="bi bi-trash-fill me-1"></i>Delete
                  </a>
                {% elif request.user.id in ad.applicants %}
                  <span class="badge bg-warning text-dark">Pending Confirmation</span>
                {% else %}
                  <form method="post" action="{% url 'advertisements:apply_to_ad' ad.pk %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-light btn-sm">
                      <i class="bi bi-hand-thumbs-up me-1"></i>Apply
                    </button>
                  </form>
                {% endif %}
              </div>

            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-12">
          <div class="alert alert-warning text-center" role="alert">
            No advertisements available
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
{% endblock %}

<style>
    .hover-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.5);
    }
</style>